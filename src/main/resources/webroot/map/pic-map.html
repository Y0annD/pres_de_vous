
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/google-map/google-map.html">

<link rel="import" href="post-service.html">
<link rel="import" href="post-card.html">
<!-- <link rel="import" href="search-box.html"> -->

<dom-module id="pic-map">
    <style>
        :host {
        }
		
		#controlsToggle {
		  position: absolute;
		  left: 10%;
		  bottom: 10%;
		}
    </style>
    <template>
        <post-service prov="google" lat="{{lat}}" lng="{{lng}}" posts="{{posts.google}}"></post-service>
        <post-service prov="twitter" lat="{{lat}}" lng="{{lng}}" posts="{{posts.twitter}}"></post-service>
        <post-service prov="insta" lat="{{lat}}" lng="{{lng}}" posts="{{posts.insta}}"></post-service>
		
        <google-map disable-default-ui latitude="{{lat}}" longitude="{{lng}}" zoom="15" language="fr">
			
            <template is="dom-repeat" items="{{posts.google.results}}">
                <google-map-marker
					icon="img/gmark-small.png"
					latitude="{{item.location.latitude}}"
					longitude="{{item.location.longitude}}"
					title="{{item.author.username}}"
					language="fr">
					
                    <post-card
                        favorite="{{item.favorite}}"
                        on-favorite-tap="{{handleFavorite}}"
                        hidden?="{{show == 'favorites' && !post.favorite}}">
						
                        <img class="round" src="{{item.author.profile_picture}}" width="70" height="70">
                        <h2>{{item.author.username}}</h2>
                        <!-- <p>{{item.location.name}}}}</p> --><br /><br />
						<img src="{{item.image.url}}" alt="{{item.author.username}}" />
						<a href="{{item.link}}" title="{{item.location.name}}">{{item.link}}</a>
						
                    </post-card>
					
                </google-map-marker>
            </template>
			
            <template is="dom-repeat" items="{{posts.twitter.results}}">
                <google-map-marker
					icon="img/tmark-small.png"
					latitude="{{item.location.latitude}}"
					longitude="{{item.location.longitude}}"
					title="{{item.text}}"
					language="fr">
						
					<post-card
						favorite="{{item.favorite}}"
						on-favorite-tap="{{handleFavorite}}"
						hidden?="{{show == 'favorites' && !post.favorite}}">
						
						<img class="round" src="{{item.author.profile_picture}}" width="70" height="70">
						<h2>{{item.author.username}}</h2>
						<p>{{item.text}}</p><br /><br />
						<!-- <img src="{{item.}}" alt="{{item.text}}" /> -->
						<a href="{{item.link}}" title="{{item.text}}">{{item.link}}</a>
							
					</post-card>
					
                </google-map-marker>
            </template>
			
            <template is="dom-repeat" items="{{posts.insta.results}}">
                <google-map-marker
					icon="img/imark-small.png"
					latitude="{{item.location.latitude}}"
					longitude="{{item.location.longitude}}"
					title="{{item.location.name}}"
					language="fr">
					
                    <post-card
                        favorite="{{item.favorite}}"
                        on-favorite-tap="{{handleFavorite}}"
                        hidden?="{{show == 'favorites' && !post.favorite}}">
						
                        <img class="round" src="{{item.author.profile_picture}}" width="70" height="70">
                        <h2>{{item.author.username}}</h2>
                        <p>{{item.location.name}}}}</p><br /><br />
						<img src="{{item.image.url}}" alt="{{item.location.name}}" />
						<a href="{{item.link}}" title="{{item.location.name}}">{{item.link}}</a>
						
                    </post-card>
					
                </google-map-marker>
            </template>
			
        </google-map>
		
		<button id="controlsToggle" on-click="togglePlace">Go ENIBar</button>

        <div id="search">
            <iron-icon icon="icons:search"></iron-icon>
            <input placeholder="Emplacement">
        </div>
		
		<!-- <search-box location="{{location}}"></search-box> -->
    </template>
    <script>
        Polymer({
            is: 'pic-map',

            properties: {
                posts: {
                    type: Object,
                    value: {}
                },
                lat: {
                    type: Number,
                    value: 0,
					notify: true,
					reflectToAttribute: true
                },
                lng: {
                    type: Number,
                    value: 0,
					notify: true,
					reflectToAttribute: true
                }
            },
			
			observers: [
				'geoChanged(lat, lng)'
			],
			
			geoChanged: function(lat, lng) {
				document.querySelector('google-map').resize();
			},
			
			togglePlace: function() {
				document.querySelector('google-map').clear();
				this.lat = 48.3612161;
				this.lng = -4.5661822;
			},
			
			/*ready: function() {
				var map = document.querySelector('google-map');
				
				// Création champ de recherche
				var input = document.getElementById('search');
				var autocomplete = new google.maps.places.Autocomplete(input);
				var place;

				// Ancrage top-left
				//map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

				// Listener : Enter = premier résultat
				google.maps.event.addDomListener(input, 'keydown', function(key) {
					if (key.keyCode === 13 && !key.triggered) {
						google.maps.event.trigger(this, 'keydown', {keyCode: 40});
						google.maps.event.trigger(this, 'keydown', {keyCode: 13, triggered: true});
					}
				});

				// Listener : clic sur un résultat
				google.maps.event.addListener(autocomplete, 'place_changed', function() {
					place = autocomplete.getPlace();
					
					this.lat = place.geometry.location.lat();
					this.lng = place.geometry.location.lng();
					
					map.clear();
					map.resize();
				});

				// Listener : clic champ
				input.addEventListener('click', function() {
					input.value = '';
				});
			}*/
        });
    </script>
</dom-module>
