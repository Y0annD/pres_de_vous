<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/google-map/google-map.html">

<link rel="import" href="post-service.html">
<link rel="import" href="post-card.html">
<link rel="import" href="search-box.html">

<dom-module id="pic-map">
    <style>
        google-map {
			display: block;
			height: 100%;
        }
    </style>
    <template>
		<!-- POUR SIMU OFFLINE (fake API) : Ajouter fake-api="path/to/static-data.json" dans le tag post-service désiré (le format du JSON doit être compatible). -->
		
        <!-- <post-service prov="google" lat="{{lat}}" lng="{{lng}}" posts="{{posts.google}}"></post-service> -->
        <!-- <post-service fake-api="fake-twit.json" prov="twitter" lat="{{lat}}" lng="{{lng}}" posts="{{posts.twitter}}"></post-service> -->
        <post-service prov="insta" lat="{{lat}}" lng="{{lng}}" posts="{{posts.insta}}"></post-service>
		
        <google-map disable-default-ui latitude="{{lat}}" longitude="{{lng}}" draggable="false" zoom="15" max-zoom="15" min-zoom="15" language="fr">
			
            <template is="dom-repeat" items="{{posts.google.results}}">
                <google-map-marker
					icon="img/gmark-small.png"
					latitude="{{item.location.latitude}}"
					longitude="{{item.location.longitude}}"
					title="{{item.author.username}}"
					language="fr">
					
                    <post-card>
                        <img class="round" src="{{item.author.profile_picture}}" width="70" height="70">
                        <h2>{{item.author.username}}</h2>
                        <p>{{item.location.name}}}}</p><br />
						<img src="{{item.image.url}}" alt="{{item.author.username}}" />
						<a href="{{item.link}}" title="{{item.location.name}}">{{item.link}}</a>
                    </post-card>
					
                </google-map-marker>
            </template>
			
            <template is="dom-repeat" items="{{posts.twitter.results}}">
                <google-map-marker
					icon="img/tmark-small.png"
					latitude="{{item.location.latitude}}"
					longitude="{{item.location.longitude}}"
					title="{{item.text}}"
					language="fr">
						
					<post-card>
						<img class="round" src="{{item.author.profile_picture}}" width="70" height="70">
						<h2>{{item.author.username}}</h2>
						<p>{{item.text}}</p><br />
						<a href="{{item.link}}" title="{{item.text}}">{{item.link}}</a>
					</post-card>
					
                </google-map-marker>
            </template>
			
            <template is="dom-repeat" items="{{posts.insta.results}}">
                <google-map-marker
					icon="img/imark-small.png"
					latitude="{{item.location.latitude}}"
					longitude="{{item.location.longitude}}"
					title="{{item.location.name}}"
					language="fr">
					
                    <post-card>
                        <img class="round" src="{{item.author.profile_picture}}" width="70" height="70">
                        <h2>{{item.author.username}}</h2>
                        <p>{{item.location.name}}}}</p><br />
						<img src="{{item.image.url}}" alt="{{item.location.name}}" />
						<a href="{{item.link}}" title="{{item.location.name}}">{{item.link}}</a>
                    </post-card>
					
                </google-map-marker>
            </template>
			
        </google-map>
		
		<search-box language="fr" lat="{{lat}}" lng="{{lng}}" on-search="searchHandler"></search-box>
    </template>
    <script>
        Polymer({
            is: 'pic-map',

            properties: {
                posts: {
                    type: Object,
                    value: {}
                },
                lat: {
                    type: Number,
                    value: 0,
					notify: true,
					reflectToAttribute: true
                },
                lng: {
                    type: Number,
                    value: 0,
					notify: true,
					reflectToAttribute: true
                }
            },
			
			observers: [
				'geoChanged(lat, lng)'
			],
			
			geoChanged: function(lat, lng) {
				//document.querySelector('google-map').clear();
				//document.querySelector('google-map').resize();
			},
			
			searchHandler: function() {
				document.querySelector('google-map').clear();
				document.querySelector('google-map').resize();
			}
        });
    </script>
</dom-module>
